<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags-->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Title Page-->
	<title>DVXLab ESP8266 IOT</title>

	<link href="material-design-iconic-font.min.css" rel="stylesheet" media="all">
	
	<!-- Bootstrap CSS-->
	<link href="bootstrap.min.css" rel="stylesheet" media="all">
	<link href="css-circular-prog-bar.css" rel="stylesheet" media="all">
	<!-- Main CSS-->
	<link href="theme.css" rel="stylesheet" media="all">
	<style>
		.mycontent-left {
  border-right: 3px solid #333;
}
	</style>

</head>

<body class="animsition" onload="javascript:mc_init()">
	<div class="page-wrapper">
		<!-- PAGE CONTAINER-->
		<div class="container">
			<!-- MAIN CONTENT-->
			<div class="main-content">
				<div class="section__content section__content--p30">
					<div class="container-fluid">
						<div class="row">
							<div class="col-md-12 table-responsive table-responsive-data2">
								<form id="ledform" >
								<table class="table table-data2 " style="border-collapse: initial;" >
									<tbody id="controlTable">
										<tr >
											<td>
												<label class="label">LED 1 </label>
												<label class="switch switch-text switch-success switch-pill">
													<input type="checkbox" id="led1" name="led1" class="switch-input" checked="true" >
													<span data-on="On" data-off="Off" class="switch-label"></span>
													<span class="switch-handle"></span>
													</label>
													
												 <input type="range" class="custom-range" min="0" max="1000" id="customRange" onchange="updaterange(this.value);">
												 <span id="rangeText"></span>											</td>
											<td colspan="2">
												<h4 class="text-center title-2 text-danger">ESP8266 - DH11 </h4>
											</td>

										</tr>
										<tr >
											<td>
												<label class="label">LED 2 </label>
												<label class="switch switch-text switch-success switch-pill">
													<input type="checkbox" class="switch-input" id="led2" name="led2" checked="true">
													<span data-on="On" data-off="Off" class="switch-label"></span>
													<span class="switch-handle"></span>
												</label>
											</td>
											<td rowspan="3" >
												<div class="progress-circle p10" id="temperature_class">
													<span id="temperature_text">10 C</span>
													<div class="left-half-clipper">
														<div class="first50-bar"></div>
														<div class="value-bar"></div>
													</div>
												</div>
											</td>
											<td rowspan="3" ">
												<div class="progress-circle p10" id="humidity_class">
													<span id="humidity_text">50%</span>
													<div class="left-half-clipper">
														<div class="first50-bar"></div>
														<div class="value-bar"></div>
													</div>
												</div>
											</td>
											
										</tr>
										<tr >
											<td>
												<label class="label">LED 3 </label>
												<label class="switch switch-text switch-success switch-pill">
													<input type="checkbox" id="led3" name="led3" class="switch-input" checked="true">
													<span data-on="On" data-off="Off" class="switch-label"></span>
													<span class="switch-handle"></span>
												</label>
											</td>
											
										</tr>
										<tr >
											<td>
												<label class="label">LED 4 </label>
												<label class="switch switch-text switch-success switch-pill">
													<input type="checkbox" id="led4" name="led4" class="switch-input" checked="true">
													<span data-on="On" data-off="Off" class="switch-label"></span>
													<span class="switch-handle"></span>
												</label>
											</td>
											
										</tr>
										
										<tr >
											<td>
												<i class="zmdi zmdi-settings" data-toggle="modal" data-target="#smallmodal"> &nbsp; Settings </i>
											</td>
											<td>
												<h3 class="text-center title-2 text-primary">Temperature</h3>
											</td>
											<td>
												<h3 class="text-center title-2 text-primary">Humidity</h3>
											</td>
											
										</tr>
									</tbody>

								</table>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			

			<!-- modal small -->
			<div class="modal fade" id="smallmodal" tabindex="-1" role="dialog" aria-labelledby="smallmodalLabel" aria-hidden="true">
				<div class="modal-dialog modal-sm" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="smallModalLabel">Settings</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
									<form action="" method="post" enctype="multipart/form-data" class="form-horizontal">

										<div class="row form-group">
											<div class="col col-md-4">
												<label class=" form-control-label">Unit</label>
											</div>
											<div class="col col-md-5">
												<div class="form-check">
													<div class="radio">
														<label for="radio1" class="form-check-label ">
															<input type="radio" id="radio1" name="radios" checked="true" value="c" class="form-check-input"> Celsius
														</label>
													</div>
													<div class="radio">
														<label for="radio2" class="form-check-label ">
															<input type="radio" id="radio2" name="radios" value="f" class="form-check-input">Farenheit
														</label>
													</div>
												</div>
											</div>
										</div>

										<div class="row form-group">
											<div class="col col-md-4">
												<label for="color" class=" form-control-label">Color</label>
											</div>
											<div class="col-12 col-md-5">
												<input type="color" id="color" name="color" value="#fdffff" onChange="document.getElementById('controlTable').style.background = this.value;">
											</div>
										</div>

										<div class="row form-group">
											<div class="col col-md-4">
												<label for="text-input" class=" form-control-label">Alarm + </label>
											</div>
											<div class="col-12 col-md-5">
												<input type="number" id="text-input" name="text_upper_limit" min="1" max="10" class="form-control">
											</div>
										</div>

										<div class="row form-group">
											<div class="col col-md-4">
												<label for="text-input" class=" form-control-label">Alarm - </label>
											</div>
											<div class="col-12 col-md-5">
												<input type="text" id="text-input" name="text_lower-limit" min="1" max="10"  class="form-control">
											</div>
										</div>

										<div class="row form-group">
											<div class="col col-md-4">
												<label class=" form-control-label">Notification</label>
											</div>
											<div class="col-12 col-md-5">
												<label class="switch switch-text switch-success switch-pill">
													<input type="checkbox" class="switch-input" checked="true">
													<span data-on="On" data-off="Off" class="switch-label"></span>
													<span class="switch-handle"></span>
												</label>
											</div>
										</div>						
										
									</form>
								
						</div>
						<div class="modal-footer">
							<!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
							<button type="button" class="btn btn-primary">Confirm</button> -->
						</div>
					</div>
				</div>
			</div>
			<!-- end modal medium -->
		</div>
		<!-- END PAGE CONTAINER-->

	</div>

	<!-- Jquery JS-->
	<script src="jquery-3.2.1.min.js"></script>
	<script src="bootstrap.min.js"></script>
	<script>
		var socket;
		function mc_init(){
			socket = new WebSocket('ws://'+window.location.hostname+':81/');
			socket.onmessage = function(event) {
				var msg_string = event.data;
				var msg = JSON.parse(msg_string);
				console.log(msg);
				updateStatus(msg);
			}

		}

		function sendSocketData(data){
			socket.send(JSON. stringify(data));
		}
		var switchStatus = 0;
        $("#led1,#led2,#led3,#led4").on('change', function() {
			prepareAndSendData();
	    });

	function prepareAndSendData(){
		var json_data = {'message': 'led'};
			$('#ledform input[type="checkbox"]').each(function(){
                if ($(this).is(':checked')) {
					switchStatus = 1;
					if(this.name == "led1"){
						switchStatus = $('#customRange').val();
					}
   		        }else {
					   switchStatus = 0;
					   if(this.name == "led1"){
							$('#customRange').val(0);
							$('#rangeText').html(0);
					   }
				}
				json_data[this.name] = switchStatus;
			});
		sendSocketData(json_data);
	}
	function updateStatus(msg){
		var temperature = msg.temperature;
		var humidity = msg.humidity;
		$('#temperature_class').removeClass();
		$('#temperature_class').addClass("progress-circle p"+temperature);
		if($("input[name='radios']:checked").val() == "f"){
			temperature = (temperature*1.8)+32;
			$('#temperature_text').text(temperature+" F");
		}else{
			$('#temperature_text').text(temperature+" C");
		}
		
		
		$('#humidity_class').removeClass();
		$('#humidity_class').addClass("progress-circle p"+humidity);
		$('#humidity_text').text(humidity+"%");
	}

	function updaterange(value){
		$("#rangeText").html(value);
		prepareAndSendData();
	}

	</script>

</body>

</html>
<!-- end document-->
